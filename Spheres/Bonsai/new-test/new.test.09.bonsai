<?xml version="1.0" encoding="utf-8"?>
<WorkflowBuilder Version="2.6.0"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xmlns:gl="clr-namespace:Bonsai.Shaders;assembly=Bonsai.Shaders"
                 xmlns:res="clr-namespace:Bonsai.Resources;assembly=Bonsai.System"
                 xmlns:wie="clr-namespace:Bonsai.Windows.Input;assembly=Bonsai.Windows.Input"
                 xmlns:dsp="clr-namespace:Bonsai.Dsp;assembly=Bonsai.Dsp"
                 xmlns:io="clr-namespace:Bonsai.IO;assembly=Bonsai.System"
                 xmlns:rx="clr-namespace:Bonsai.Reactive;assembly=Bonsai.Core"
                 xmlns:scr="clr-namespace:Bonsai.Scripting;assembly=Bonsai.Scripting"
                 xmlns:sys="clr-namespace:System;assembly=mscorlib"
                 xmlns:num="clr-namespace:Bonsai.Numerics;assembly=Bonsai.Numerics"
                 xmlns:p1="clr-namespace:;assembly=Extensions"
                 xmlns="https://bonsai-rx.org/2018/workflow">
  <Workflow>
    <Nodes>
      <Expression xsi:type="GroupWorkflow">
        <Name>InitBonvision3D</Name>
        <Workflow>
          <Nodes>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:CreateWindow">
                <gl:Width>640</gl:Width>
                <gl:Height>480</gl:Height>
                <gl:VSync>On</gl:VSync>
                <gl:SwapSync>false</gl:SwapSync>
                <gl:ClearColor>Gray</gl:ClearColor>
                <gl:ClearMask>DepthBufferBit ColorBufferBit</gl:ClearMask>
                <gl:CursorVisible>true</gl:CursorVisible>
                <gl:Location xsi:nil="true" />
                <gl:WindowBorder>Resizable</gl:WindowBorder>
                <gl:WindowState>Normal</gl:WindowState>
                <gl:DisplayDevice>Primary</gl:DisplayDevice>
                <gl:TargetRenderFrequency>60</gl:TargetRenderFrequency>
                <gl:TargetUpdateFrequency xsi:nil="true" />
                <gl:RenderState />
                <gl:GraphicsMode>
                  <gl:ColorFormat>
                    <gl:Red>8</gl:Red>
                    <gl:Green>8</gl:Green>
                    <gl:Blue>8</gl:Blue>
                    <gl:Alpha>8</gl:Alpha>
                  </gl:ColorFormat>
                  <gl:Depth>16</gl:Depth>
                  <gl:Stencil>0</gl:Stencil>
                  <gl:Samples>0</gl:Samples>
                  <gl:AccumulatorFormat>
                    <gl:Red>0</gl:Red>
                    <gl:Green>0</gl:Green>
                    <gl:Blue>0</gl:Blue>
                    <gl:Alpha>0</gl:Alpha>
                  </gl:AccumulatorFormat>
                  <gl:Buffers>2</gl:Buffers>
                  <gl:Stereo>false</gl:Stereo>
                </gl:GraphicsMode>
              </Combinator>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.BonVisionResources.bonsai" />
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:ShaderResources">
                <gl:Shaders />
              </Combinator>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:MeshResources">
                <gl:Meshes>
                  <gl:MeshConfiguration xsi:type="gl:TexturedModel">
                    <gl:Name>sphere</gl:Name>
                    <gl:FileName>E:\vis-stim\vis-stim-depth\Spheres\Objects\sphere.obj</gl:FileName>
                  </gl:MeshConfiguration>
                </gl:Meshes>
              </Combinator>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="res:LoadResources" />
            </Expression>
            <Expression xsi:type="Disable">
              <Builder xsi:type="Combinator">
                <Combinator xsi:type="wie:MouseMove" />
              </Builder>
            </Expression>
            <Expression xsi:type="Disable">
              <Builder xsi:type="MemberSelector">
                <Selector>Y</Selector>
              </Builder>
            </Expression>
            <Expression xsi:type="Disable">
              <Builder xsi:type="Combinator">
                <Combinator xsi:type="dsp:Rescale">
                  <dsp:Min>0</dsp:Min>
                  <dsp:Max>2000</dsp:Max>
                  <dsp:RangeMin>0</dsp:RangeMin>
                  <dsp:RangeMax>10</dsp:RangeMax>
                  <dsp:RescaleType>Linear</dsp:RescaleType>
                </Combinator>
              </Builder>
            </Expression>
            <Expression xsi:type="Disable">
              <Builder xsi:type="Combinator">
                <Combinator xsi:type="gl:LatestOnUpdateFrame" />
              </Builder>
            </Expression>
            <Expression xsi:type="Disable">
              <Builder xsi:type="PublishSubject">
                <Name>MouseZ</Name>
              </Builder>
            </Expression>
            <Expression xsi:type="ExternalizedMapping">
              <Property Name="ScreenCalibFile" Category="Calibrations" />
              <Property Name="GammaCalibFile" Category="Calibrations" />
            </Expression>
            <Expression xsi:type="GroupWorkflow">
              <Name>CalibrationFiles</Name>
              <Workflow>
                <Nodes>
                  <Expression xsi:type="ExternalizedMapping">
                    <Property Name="FileName" DisplayName="ScreenCalibFile" Category="Calibration" />
                  </Expression>
                  <Expression xsi:type="io:CsvReader">
                    <io:FileName>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\monitor_calibration.csv</io:FileName>
                    <io:ListSeparator>,</io:ListSeparator>
                    <io:ScanPattern>%f</io:ScanPattern>
                    <io:SkipRows>1</io:SkipRows>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:ToArray" />
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
it[0] as Screen1_params,
it[1] as Screen2_params,
it[2] as Screen3_params,
it[3] as Screen4_params
)</scr:Expression>
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Screen1_params</Selector>
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
it[0] as Height,
it[1] as Width,
it[2] as RotationX,
-it[3] as RotationY,
it[4] as RotationZ,
it[5] as TranslationX,
it[6] as TranslationY,
-it[7] as TranslationZ,
it[8] as ViewportWidth,
it[9] as ViewportX
)

</scr:Expression>
                  </Expression>
                  <Expression xsi:type="ReplaySubject">
                    <Name>Screen1pos</Name>
                    <BufferSize xsi:nil="true" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Screen2_params</Selector>
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
it[0] as Height,
it[1] as Width,
it[2] as RotationX,
-it[3] as RotationY,
it[4] as RotationZ,
it[5] as TranslationX,
it[6] as TranslationY,
-it[7] as TranslationZ,
it[8] as ViewportWidth,
it[9] as ViewportX
)

</scr:Expression>
                  </Expression>
                  <Expression xsi:type="ReplaySubject">
                    <Name>Screen2pos</Name>
                    <BufferSize xsi:nil="true" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Screen3_params</Selector>
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
it[0] as Height,
it[1] as Width,
it[2] as RotationX,
-it[3] as RotationY,
it[4] as RotationZ,
it[5] as TranslationX,
it[6] as TranslationY,
-it[7] as TranslationZ,
it[8] as ViewportWidth,
it[9] as ViewportX
)

</scr:Expression>
                  </Expression>
                  <Expression xsi:type="ReplaySubject">
                    <Name>Screen3pos</Name>
                    <BufferSize xsi:nil="true" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Screen4_params</Selector>
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
it[0] as Height,
it[1] as Width,
it[2] as RotationX,
-it[3] as RotationY,
it[4] as RotationZ,
it[5] as TranslationX,
it[6] as TranslationY,
-it[7] as TranslationZ,
it[8] as ViewportWidth,
it[9] as ViewportX
)

</scr:Expression>
                  </Expression>
                  <Expression xsi:type="ReplaySubject">
                    <Name>Screen4pos</Name>
                    <BufferSize xsi:nil="true" />
                  </Expression>
                  <Expression xsi:type="ExternalizedMapping">
                    <Property Name="FileName" DisplayName="GammaCalibFile" Category="Calibration" />
                  </Expression>
                  <Expression xsi:type="io:CsvReader">
                    <io:FileName>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration.csv</io:FileName>
                    <io:ListSeparator />
                    <io:ScanPattern>%s</io:ScanPattern>
                    <io:SkipRows>0</io:SkipRows>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:ToArray" />
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
it[0] as Screen1_gammalut,
it[1] as Screen2_gammalut,
it[2] as Screen3_gammalut,
it[3] as Screen4_gammalut
)</scr:Expression>
                  </Expression>
                  <Expression xsi:type="ReplaySubject">
                    <Name>GammaLut</Name>
                    <BufferSize xsi:nil="true" />
                  </Expression>
                </Nodes>
                <Edges>
                  <Edge From="0" To="1" Label="Source1" />
                  <Edge From="1" To="2" Label="Source1" />
                  <Edge From="2" To="3" Label="Source1" />
                  <Edge From="3" To="4" Label="Source1" />
                  <Edge From="3" To="7" Label="Source1" />
                  <Edge From="3" To="10" Label="Source1" />
                  <Edge From="3" To="13" Label="Source1" />
                  <Edge From="4" To="5" Label="Source1" />
                  <Edge From="5" To="6" Label="Source1" />
                  <Edge From="7" To="8" Label="Source1" />
                  <Edge From="8" To="9" Label="Source1" />
                  <Edge From="10" To="11" Label="Source1" />
                  <Edge From="11" To="12" Label="Source1" />
                  <Edge From="13" To="14" Label="Source1" />
                  <Edge From="14" To="15" Label="Source1" />
                  <Edge From="16" To="17" Label="Source1" />
                  <Edge From="17" To="18" Label="Source1" />
                  <Edge From="18" To="19" Label="Source1" />
                  <Edge From="19" To="20" Label="Source1" />
                </Edges>
              </Workflow>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>MouseZ</Name>
            </Expression>
            <Expression xsi:type="scr:ExpressionTransform">
              <scr:Name>Rename1</scr:Name>
              <scr:Expression>new(
0 as X,
0 as Y,
it as EyeZ)</scr:Expression>
            </Expression>
            <Expression xsi:type="PropertyMapping">
              <PropertyMappings>
                <Property Name="Eye" Selector="X,Y,EyeZ" />
              </PropertyMappings>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:RenderFrame" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:UpdateViewportState">
                <gl:X>0</gl:X>
                <gl:Y>0</gl:Y>
                <gl:Width>1</gl:Width>
                <gl:Height>1</gl:Height>
              </Combinator>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.CubemapView.bonsai">
              <Eye>
                <X>0</X>
                <Y>0</Y>
                <Z>5.40540552</Z>
              </Eye>
              <NearClip>0.1</NearClip>
              <FarClip>1000</FarClip>
              <Light>
                <X>0</X>
                <Y>0</Y>
                <Z>0</Z>
              </Light>
            </Expression>
            <Expression xsi:type="PublishSubject">
              <Name>Draw</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:RenderCubemap">
                <gl:RenderState />
                <gl:ClearColor>Gray</gl:ClearColor>
                <gl:ClearMask>DepthBufferBit ColorBufferBit</gl:ClearMask>
                <gl:FaceSize xsi:nil="true" />
                <gl:InternalFormat>Rgb</gl:InternalFormat>
                <gl:MinFilter>Linear</gl:MinFilter>
                <gl:MagFilter>Linear</gl:MagFilter>
              </Combinator>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen1pos</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="Width" Selector="Item2.Width" />
                <Property Name="Height" Selector="Item2.Height" />
                <Property Name="Rotation" Selector="Item2.RotationX,Item2.RotationY,Item2.RotationZ" />
                <Property Name="Translation" Selector="Item2.TranslationX,Item2.TranslationY,Item2.TranslationZ" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.ViewWindow.bonsai">
              <Width>29.296875</Width>
              <Height>52.0833321</Height>
              <Rotation>
                <X>0.00062900001648813486</X>
                <Y>-1.5299999713897705</Y>
                <Z>0.0082700001075863838</Z>
              </Rotation>
              <Translation>
                <X>-27</X>
                <Y>-0.11900000274181366</Y>
                <Z>0.79100000858306885</Z>
              </Translation>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen2pos</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen3pos</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen4pos</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>GammaLut</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Screen1_gammalut</Selector>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="GammaLut" Selector="Item2" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="GroupWorkflow">
              <Name>GammaCorrection</Name>
              <Description>Renders the current scene to a texture and applies gamma correction as a post-processing effect.</Description>
              <Workflow>
                <Nodes>
                  <Expression xsi:type="WorkflowInput">
                    <Name>Source1</Name>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:UpdateViewportState">
                      <gl:X>0</gl:X>
                      <gl:Y>0</gl:Y>
                      <gl:Width>1</gl:Width>
                      <gl:Height>1</gl:Height>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>ClearColor</MemberName>
                    <Name>ClearColor</Name>
                    <Category>Misc</Category>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:RenderTexture">
                      <gl:RenderState />
                      <gl:ClearColor>Gray</gl:ClearColor>
                      <gl:ClearMask>DepthBufferBit ColorBufferBit</gl:ClearMask>
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgb</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture0</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>Value</MemberName>
                    <Name>GammaLut</Name>
                  </Expression>
                  <Expression xsi:type="PropertySource" TypeArguments="gl:LoadImage,sys:String">
                    <MemberName>FileName</MemberName>
                    <Value>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr01.bmp</Value>
                  </Expression>
                  <Expression xsi:type="InputMapping">
                    <PropertyMappings>
                      <Property Name="FileName" />
                    </PropertyMappings>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:LoadImage">
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgba</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                      <gl:FileName>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr01.bmp</gl:FileName>
                      <gl:ColorType>Unchanged</gl:ColorType>
                      <gl:FlipMode>Vertical</gl:FlipMode>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:WithLatestFrom" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Item2</Selector>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture1</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:DrawMesh">
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:MeshName>ViewportQuad</gl:MeshName>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="WorkflowOutput" />
                </Nodes>
                <Edges>
                  <Edge From="0" To="1" Label="Source1" />
                  <Edge From="1" To="3" Label="Source1" />
                  <Edge From="2" To="3" Label="Source2" />
                  <Edge From="3" To="4" Label="Source1" />
                  <Edge From="4" To="9" Label="Source1" />
                  <Edge From="5" To="6" Label="Source1" />
                  <Edge From="6" To="7" Label="Source1" />
                  <Edge From="7" To="8" Label="Source1" />
                  <Edge From="8" To="9" Label="Source2" />
                  <Edge From="9" To="10" Label="Source1" />
                  <Edge From="10" To="11" Label="Source1" />
                  <Edge From="11" To="12" Label="Source1" />
                  <Edge From="12" To="13" Label="Source1" />
                </Edges>
              </Workflow>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>GammaLut</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Screen2_gammalut</Selector>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>GammaLut</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Screen3_gammalut</Selector>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>GammaLut</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Screen4_gammalut</Selector>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen1pos</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="X" Selector="Item2.ViewportX" />
                <Property Name="Width" Selector="Item2.ViewportWidth" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.DrawViewport.bonsai">
              <X>0</X>
              <Y>0</Y>
              <Width>0.25</Width>
              <Height>1</Height>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="Width" Selector="Item2.Width" />
                <Property Name="Height" Selector="Item2.Height" />
                <Property Name="Rotation" Selector="Item2.RotationX,Item2.RotationY,Item2.RotationZ" />
                <Property Name="Translation" Selector="Item2.TranslationX,Item2.TranslationY,Item2.TranslationZ" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.ViewWindow.bonsai">
              <Width>29.296875</Width>
              <Height>52.0833321</Height>
              <Rotation>
                <X>0.0017999999690800905</X>
                <Y>-0.47299998998641968</Y>
                <Z>0.018699999898672104</Z>
              </Rotation>
              <Translation>
                <X>-13.300000190734863</X>
                <Y>0.29100000858306885</Y>
                <Z>23.5</Z>
              </Translation>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="GammaLut" Selector="Item2" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="GroupWorkflow">
              <Name>GammaCorrection</Name>
              <Description>Renders the current scene to a texture and applies gamma correction as a post-processing effect.</Description>
              <Workflow>
                <Nodes>
                  <Expression xsi:type="WorkflowInput">
                    <Name>Source1</Name>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:UpdateViewportState">
                      <gl:X>0</gl:X>
                      <gl:Y>0</gl:Y>
                      <gl:Width>1</gl:Width>
                      <gl:Height>1</gl:Height>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>ClearColor</MemberName>
                    <Name>ClearColor</Name>
                    <Category>Misc</Category>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:RenderTexture">
                      <gl:RenderState />
                      <gl:ClearColor>Gray</gl:ClearColor>
                      <gl:ClearMask>DepthBufferBit ColorBufferBit</gl:ClearMask>
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgb</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture0</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>Value</MemberName>
                    <Name>GammaLut</Name>
                  </Expression>
                  <Expression xsi:type="PropertySource" TypeArguments="gl:LoadImage,sys:String">
                    <MemberName>FileName</MemberName>
                    <Value>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr02.bmp</Value>
                  </Expression>
                  <Expression xsi:type="InputMapping">
                    <PropertyMappings>
                      <Property Name="FileName" />
                    </PropertyMappings>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:LoadImage">
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgba</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                      <gl:FileName>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr02.bmp</gl:FileName>
                      <gl:ColorType>Unchanged</gl:ColorType>
                      <gl:FlipMode>Vertical</gl:FlipMode>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:WithLatestFrom" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Item2</Selector>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture1</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:DrawMesh">
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:MeshName>ViewportQuad</gl:MeshName>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="WorkflowOutput" />
                </Nodes>
                <Edges>
                  <Edge From="0" To="1" Label="Source1" />
                  <Edge From="1" To="3" Label="Source1" />
                  <Edge From="2" To="3" Label="Source2" />
                  <Edge From="3" To="4" Label="Source1" />
                  <Edge From="4" To="9" Label="Source1" />
                  <Edge From="5" To="6" Label="Source1" />
                  <Edge From="6" To="7" Label="Source1" />
                  <Edge From="7" To="8" Label="Source1" />
                  <Edge From="8" To="9" Label="Source2" />
                  <Edge From="9" To="10" Label="Source1" />
                  <Edge From="10" To="11" Label="Source1" />
                  <Edge From="11" To="12" Label="Source1" />
                  <Edge From="12" To="13" Label="Source1" />
                </Edges>
              </Workflow>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen2pos</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="X" Selector="Item2.ViewportX" />
                <Property Name="Width" Selector="Item2.ViewportWidth" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.DrawViewport.bonsai">
              <X>0.25</X>
              <Y>0</Y>
              <Width>0.25</Width>
              <Height>1</Height>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="Width" Selector="Item2.Width" />
                <Property Name="Height" Selector="Item2.Height" />
                <Property Name="Rotation" Selector="Item2.RotationX,Item2.RotationY,Item2.RotationZ" />
                <Property Name="Translation" Selector="Item2.TranslationX,Item2.TranslationY,Item2.TranslationZ" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.ViewWindow.bonsai">
              <Width>29.296875</Width>
              <Height>52.0833321</Height>
              <Rotation>
                <X>0.014499999582767487</X>
                <Y>0.42399999499320984</Y>
                <Z>0.008320000022649765</Z>
              </Rotation>
              <Translation>
                <X>16.200000762939453</X>
                <Y>0.51899999380111694</Y>
                <Z>21.299999237060547</Z>
              </Translation>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="GammaLut" Selector="Item2" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="GroupWorkflow">
              <Name>GammaCorrection</Name>
              <Description>Renders the current scene to a texture and applies gamma correction as a post-processing effect.</Description>
              <Workflow>
                <Nodes>
                  <Expression xsi:type="WorkflowInput">
                    <Name>Source1</Name>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:UpdateViewportState">
                      <gl:X>0</gl:X>
                      <gl:Y>0</gl:Y>
                      <gl:Width>1</gl:Width>
                      <gl:Height>1</gl:Height>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>ClearColor</MemberName>
                    <Name>ClearColor</Name>
                    <Category>Misc</Category>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:RenderTexture">
                      <gl:RenderState />
                      <gl:ClearColor>Gray</gl:ClearColor>
                      <gl:ClearMask>DepthBufferBit ColorBufferBit</gl:ClearMask>
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgb</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture0</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>Value</MemberName>
                    <Name>GammaLut</Name>
                  </Expression>
                  <Expression xsi:type="PropertySource" TypeArguments="gl:LoadImage,sys:String">
                    <MemberName>FileName</MemberName>
                    <Value>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr03.bmp</Value>
                  </Expression>
                  <Expression xsi:type="InputMapping">
                    <PropertyMappings>
                      <Property Name="FileName" />
                    </PropertyMappings>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:LoadImage">
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgba</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                      <gl:FileName>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr03.bmp</gl:FileName>
                      <gl:ColorType>Unchanged</gl:ColorType>
                      <gl:FlipMode>Vertical</gl:FlipMode>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:WithLatestFrom" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Item2</Selector>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture1</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:DrawMesh">
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:MeshName>ViewportQuad</gl:MeshName>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="WorkflowOutput" />
                </Nodes>
                <Edges>
                  <Edge From="0" To="1" Label="Source1" />
                  <Edge From="1" To="3" Label="Source1" />
                  <Edge From="2" To="3" Label="Source2" />
                  <Edge From="3" To="4" Label="Source1" />
                  <Edge From="4" To="9" Label="Source1" />
                  <Edge From="5" To="6" Label="Source1" />
                  <Edge From="6" To="7" Label="Source1" />
                  <Edge From="7" To="8" Label="Source1" />
                  <Edge From="8" To="9" Label="Source2" />
                  <Edge From="9" To="10" Label="Source1" />
                  <Edge From="10" To="11" Label="Source1" />
                  <Edge From="11" To="12" Label="Source1" />
                  <Edge From="12" To="13" Label="Source1" />
                </Edges>
              </Workflow>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen3pos</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="X" Selector="Item2.ViewportX" />
                <Property Name="Width" Selector="Item2.ViewportWidth" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.DrawViewport.bonsai">
              <X>0.5</X>
              <Y>0</Y>
              <Width>0.25</Width>
              <Height>1</Height>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="Width" Selector="Item2.Width" />
                <Property Name="Height" Selector="Item2.Height" />
                <Property Name="Rotation" Selector="Item2.RotationX,Item2.RotationY,Item2.RotationZ" />
                <Property Name="Translation" Selector="Item2.TranslationX,Item2.TranslationY,Item2.TranslationZ" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.ViewWindow.bonsai">
              <Width>29.296875</Width>
              <Height>52.0833321</Height>
              <Rotation>
                <X>0.0082000000402331352</X>
                <Y>1.5900000333786011</Y>
                <Z>-0.0019099999917671084</Z>
              </Rotation>
              <Translation>
                <X>29.5</X>
                <Y>0.41800001263618469</Y>
                <Z>-0.65100002288818359</Z>
              </Translation>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="GammaLut" Selector="Item2" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="GroupWorkflow">
              <Name>GammaCorrection</Name>
              <Description>Renders the current scene to a texture and applies gamma correction as a post-processing effect.</Description>
              <Workflow>
                <Nodes>
                  <Expression xsi:type="WorkflowInput">
                    <Name>Source1</Name>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:UpdateViewportState">
                      <gl:X>0</gl:X>
                      <gl:Y>0</gl:Y>
                      <gl:Width>1</gl:Width>
                      <gl:Height>1</gl:Height>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>ClearColor</MemberName>
                    <Name>ClearColor</Name>
                    <Category>Misc</Category>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:RenderTexture">
                      <gl:RenderState />
                      <gl:ClearColor>Gray</gl:ClearColor>
                      <gl:ClearMask>DepthBufferBit ColorBufferBit</gl:ClearMask>
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgb</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture0</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="ExternalizedProperty">
                    <MemberName>Value</MemberName>
                    <Name>GammaLut</Name>
                  </Expression>
                  <Expression xsi:type="PropertySource" TypeArguments="gl:LoadImage,sys:String">
                    <MemberName>FileName</MemberName>
                    <Value>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr04.bmp</Value>
                  </Expression>
                  <Expression xsi:type="InputMapping">
                    <PropertyMappings>
                      <Property Name="FileName" />
                    </PropertyMappings>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:LoadImage">
                      <gl:Width xsi:nil="true" />
                      <gl:Height xsi:nil="true" />
                      <gl:InternalFormat>Rgba</gl:InternalFormat>
                      <gl:WrapS>ClampToEdge</gl:WrapS>
                      <gl:WrapT>ClampToEdge</gl:WrapT>
                      <gl:MinFilter>Linear</gl:MinFilter>
                      <gl:MagFilter>Linear</gl:MagFilter>
                      <gl:FileName>E:\vis-stim\Intrinsic\intrinsic_imaging\Calibrations\gamma_calibration210305\gammalut_gray_Scr04.bmp</gl:FileName>
                      <gl:ColorType>Unchanged</gl:ColorType>
                      <gl:FlipMode>Vertical</gl:FlipMode>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:WithLatestFrom" />
                  </Expression>
                  <Expression xsi:type="MemberSelector">
                    <Selector>Item2</Selector>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:BindTexture">
                      <gl:TextureSlot>Texture1</gl:TextureSlot>
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:TextureTarget>Texture2D</gl:TextureTarget>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:DrawMesh">
                      <gl:ShaderName>Gamma</gl:ShaderName>
                      <gl:MeshName>ViewportQuad</gl:MeshName>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="WorkflowOutput" />
                </Nodes>
                <Edges>
                  <Edge From="0" To="1" Label="Source1" />
                  <Edge From="1" To="3" Label="Source1" />
                  <Edge From="2" To="3" Label="Source2" />
                  <Edge From="3" To="4" Label="Source1" />
                  <Edge From="4" To="9" Label="Source1" />
                  <Edge From="5" To="6" Label="Source1" />
                  <Edge From="6" To="7" Label="Source1" />
                  <Edge From="7" To="8" Label="Source1" />
                  <Edge From="8" To="9" Label="Source2" />
                  <Edge From="9" To="10" Label="Source1" />
                  <Edge From="10" To="11" Label="Source1" />
                  <Edge From="11" To="12" Label="Source1" />
                  <Edge From="12" To="13" Label="Source1" />
                </Edges>
              </Workflow>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Screen4pos</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:CombineLatest" />
            </Expression>
            <Expression xsi:type="InputMapping">
              <PropertyMappings>
                <Property Name="X" Selector="Item2.ViewportX" />
                <Property Name="Width" Selector="Item2.ViewportWidth" />
              </PropertyMappings>
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Environment.DrawViewport.bonsai">
              <X>0.75</X>
              <Y>0</Y>
              <Width>0.25</Width>
              <Height>1</Height>
            </Expression>
            <Expression xsi:type="Disable">
              <Builder xsi:type="Combinator">
                <Combinator xsi:type="rx:Zip" />
              </Builder>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.ParameterRange.bonsai">
              <RangeMin>0</RangeMin>
              <RangeMax>200</RangeMax>
              <Count>1000</Count>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:Timer">
                <gl:DueTime>PT0S</gl:DueTime>
                <gl:Period>PT0.5S</gl:Period>
              </Combinator>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:Zip" />
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="PublishSubject">
              <Name>MouseZ</Name>
            </Expression>
          </Nodes>
          <Edges>
            <Edge From="0" To="1" Label="Source1" />
            <Edge From="1" To="2" Label="Source1" />
            <Edge From="2" To="3" Label="Source1" />
            <Edge From="3" To="4" Label="Source1" />
            <Edge From="5" To="6" Label="Source1" />
            <Edge From="6" To="7" Label="Source1" />
            <Edge From="7" To="8" Label="Source1" />
            <Edge From="8" To="9" Label="Source1" />
            <Edge From="10" To="11" Label="Source1" />
            <Edge From="12" To="13" Label="Source1" />
            <Edge From="13" To="14" Label="Source1" />
            <Edge From="14" To="17" Label="Source2" />
            <Edge From="15" To="16" Label="Source1" />
            <Edge From="16" To="17" Label="Source1" />
            <Edge From="17" To="18" Label="Source1" />
            <Edge From="18" To="19" Label="Source1" />
            <Edge From="19" To="21" Label="Source1" />
            <Edge From="19" To="42" Label="Source1" />
            <Edge From="19" To="52" Label="Source1" />
            <Edge From="19" To="62" Label="Source1" />
            <Edge From="20" To="21" Label="Source2" />
            <Edge From="21" To="22" Label="Source1" />
            <Edge From="22" To="23" Label="Source1" />
            <Edge From="23" To="29" Label="Source1" />
            <Edge From="24" To="42" Label="Source2" />
            <Edge From="25" To="52" Label="Source2" />
            <Edge From="26" To="62" Label="Source2" />
            <Edge From="27" To="28" Label="Source1" />
            <Edge From="28" To="29" Label="Source2" />
            <Edge From="29" To="30" Label="Source1" />
            <Edge From="30" To="31" Label="Source1" />
            <Edge From="31" To="39" Label="Source1" />
            <Edge From="32" To="33" Label="Source1" />
            <Edge From="33" To="45" Label="Source2" />
            <Edge From="34" To="35" Label="Source1" />
            <Edge From="35" To="55" Label="Source2" />
            <Edge From="36" To="37" Label="Source1" />
            <Edge From="37" To="65" Label="Source2" />
            <Edge From="38" To="39" Label="Source2" />
            <Edge From="39" To="40" Label="Source1" />
            <Edge From="40" To="41" Label="Source1" />
            <Edge From="41" To="72" Label="Source1" />
            <Edge From="42" To="43" Label="Source1" />
            <Edge From="43" To="44" Label="Source1" />
            <Edge From="44" To="45" Label="Source1" />
            <Edge From="45" To="46" Label="Source1" />
            <Edge From="46" To="47" Label="Source1" />
            <Edge From="47" To="49" Label="Source1" />
            <Edge From="48" To="49" Label="Source2" />
            <Edge From="49" To="50" Label="Source1" />
            <Edge From="50" To="51" Label="Source1" />
            <Edge From="51" To="72" Label="Source2" />
            <Edge From="52" To="53" Label="Source1" />
            <Edge From="53" To="54" Label="Source1" />
            <Edge From="54" To="55" Label="Source1" />
            <Edge From="55" To="56" Label="Source1" />
            <Edge From="56" To="57" Label="Source1" />
            <Edge From="57" To="59" Label="Source1" />
            <Edge From="58" To="59" Label="Source2" />
            <Edge From="59" To="60" Label="Source1" />
            <Edge From="60" To="61" Label="Source1" />
            <Edge From="61" To="72" Label="Source3" />
            <Edge From="62" To="63" Label="Source1" />
            <Edge From="63" To="64" Label="Source1" />
            <Edge From="64" To="65" Label="Source1" />
            <Edge From="65" To="66" Label="Source1" />
            <Edge From="66" To="67" Label="Source1" />
            <Edge From="67" To="69" Label="Source1" />
            <Edge From="68" To="69" Label="Source2" />
            <Edge From="69" To="70" Label="Source1" />
            <Edge From="70" To="71" Label="Source1" />
            <Edge From="71" To="72" Label="Source4" />
            <Edge From="73" To="75" Label="Source1" />
            <Edge From="74" To="75" Label="Source2" />
            <Edge From="75" To="76" Label="Source1" />
            <Edge From="76" To="77" Label="Source1" />
          </Edges>
        </Workflow>
      </Expression>
      <Expression xsi:type="GroupWorkflow">
        <Name>DrawSpheres</Name>
        <Workflow>
          <Nodes>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.ParameterRange.bonsai">
              <RangeMin>-45</RangeMin>
              <RangeMax>45</RangeMax>
              <Count>10</Count>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="num:DegreeToRadian" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="num:VariationWithRepetition">
                <num:Count>1</num:Count>
              </Combinator>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.ParameterRange.bonsai">
              <RangeMin>45</RangeMin>
              <RangeMax>135</RangeMax>
              <Count>10</Count>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="num:DegreeToRadian" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="num:VariationWithRepetition">
                <num:Count>1</num:Count>
              </Combinator>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.ParameterRange.bonsai">
              <RangeMin>10</RangeMin>
              <RangeMax>1</RangeMax>
              <Count>2</Count>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="num:VariationWithRepetition">
                <num:Count>1</num:Count>
              </Combinator>
            </Expression>
            <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.ParameterRange.bonsai">
              <RangeMin>0.05</RangeMin>
              <RangeMax>0.05</RangeMax>
              <Count>2</Count>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="num:VariationWithRepetition">
                <num:Count>1</num:Count>
              </Combinator>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="gl:Timer">
                <gl:DueTime>PT0.5S</gl:DueTime>
              </Combinator>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:Zip" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:Repeat" />
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Item1</Selector>
            </Expression>
            <Expression xsi:type="PublishSubject">
              <Name>Xdeg</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Item2</Selector>
            </Expression>
            <Expression xsi:type="PublishSubject">
              <Name>Ydeg</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Item3</Selector>
            </Expression>
            <Expression xsi:type="PublishSubject">
              <Name>Zradius</Name>
            </Expression>
            <Expression xsi:type="MemberSelector">
              <Selector>Item4</Selector>
            </Expression>
            <Expression xsi:type="PublishSubject">
              <Name>Size</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Xdeg</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Ydeg</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Zradius</Name>
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>Size</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:Zip" />
            </Expression>
            <Expression xsi:type="SubscribeSubject">
              <Name>MouseZ</Name>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:WithLatestFrom" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="p1:SphericalTransform" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:ElementIndex" />
            </Expression>
            <Expression xsi:type="CreateObservable">
              <Name>CreateSpheres</Name>
              <Workflow>
                <Nodes>
                  <Expression xsi:type="WorkflowInput">
                    <Name>Source1</Name>
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="Combinator">
                      <Combinator xsi:type="IntProperty">
                        <Value>60</Value>
                      </Combinator>
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="Combinator">
                      <Combinator xsi:type="p1:CreateAmbientArray" />
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="Combinator">
                      <Combinator xsi:type="rx:Merge" />
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="Combinator">
                      <Combinator xsi:type="gl:Timer">
                        <gl:DueTime>PT0S</gl:DueTime>
                        <gl:Period>PT0.0167S</gl:Period>
                      </Combinator>
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="Combinator">
                      <Combinator xsi:type="rx:Zip" />
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="MemberSelector">
                      <Selector>Item1</Selector>
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="gl:Timer">
                      <gl:DueTime>PT4S</gl:DueTime>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="SubscribeSubject">
                    <Name>Draw</Name>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="FloatProperty">
                      <Value>1</Value>
                    </Combinator>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:CombineLatest" />
                  </Expression>
                  <Expression xsi:type="Disable">
                    <Builder xsi:type="MulticastSubject">
                      <Name>Params</Name>
                    </Builder>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:CombineLatest" />
                  </Expression>
                  <Expression xsi:type="scr:ExpressionTransform">
                    <scr:Expression>new(
Item1 as Draw,
Item2.Item1.Index as Id,
Item2.Item1.Value.Item1.Item1 as Azimuth,
Item2.Item1.Value.Item1.Item2 as Elevation,
Item2.Item1.Value.Item1.Item3 as Radius,
Item2.Item1.Value.Item2.Item1 as X,
Item2.Item1.Value.Item2.Item2 as Y,
Item2.Item1.Value.Item2.Item3 as Z,
Item2.Item1.Value.Item3.Item1 as Z0,
Item2.Item1.Value.Item3.Item2 as Size,
Item2.Item2 as Ambient
)</scr:Expression>
                  </Expression>
                  <Expression xsi:type="InputMapping">
                    <PropertyMappings>
                      <Property Name="TranslationX" Selector="X" />
                      <Property Name="TranslationY" Selector="Y" />
                      <Property Name="TranslationZ" Selector="Z" />
                      <Property Name="Ambient" Selector="Ambient" />
                      <Property Name="ScaleX" Selector="Size" />
                      <Property Name="ScaleY" Selector="Size" />
                      <Property Name="ScaleZ" Selector="Size" />
                    </PropertyMappings>
                    <Selector>Draw</Selector>
                  </Expression>
                  <Expression xsi:type="IncludeWorkflow" Path="BonVision:Primitives.DrawModel.bonsai">
                    <TranslationX>-5.79227972</TranslationX>
                    <TranslationY>-5.7357645</TranslationY>
                    <TranslationZ>10.9974852</TranslationZ>
                    <ScaleX>0.5</ScaleX>
                    <ScaleY>0.5</ScaleY>
                    <ScaleZ>0.5</ScaleZ>
                    <MeshName>sphere</MeshName>
                    <Ambient>
                      <X>0.0172413886</X>
                      <Y>0.0172413886</Y>
                      <Z>0.0172413886</Z>
                    </Ambient>
                    <Diffuse>
                      <X>0</X>
                      <Y>0</Y>
                      <Z>0</Z>
                    </Diffuse>
                    <Specular>
                      <X>0</X>
                      <Y>0</Y>
                      <Z>0</Z>
                    </Specular>
                    <SpecularExponent>10</SpecularExponent>
                    <RotationZ>0</RotationZ>
                    <RotationY>0</RotationY>
                    <RotationX>0</RotationX>
                  </Expression>
                  <Expression xsi:type="Combinator">
                    <Combinator xsi:type="rx:TakeUntil" />
                  </Expression>
                  <Expression xsi:type="WorkflowOutput" />
                </Nodes>
                <Edges>
                  <Edge From="0" To="10" Label="Source1" />
                  <Edge From="1" To="2" Label="Source1" />
                  <Edge From="2" To="3" Label="Source1" />
                  <Edge From="3" To="5" Label="Source1" />
                  <Edge From="4" To="5" Label="Source2" />
                  <Edge From="5" To="6" Label="Source1" />
                  <Edge From="6" To="10" Label="Source2" />
                  <Edge From="7" To="16" Label="Source2" />
                  <Edge From="8" To="12" Label="Source1" />
                  <Edge From="9" To="10" Label="Source3" />
                  <Edge From="10" To="11" Label="Source1" />
                  <Edge From="11" To="12" Label="Source2" />
                  <Edge From="12" To="13" Label="Source1" />
                  <Edge From="13" To="14" Label="Source1" />
                  <Edge From="14" To="15" Label="Source1" />
                  <Edge From="15" To="16" Label="Source1" />
                  <Edge From="16" To="17" Label="Source1" />
                </Edges>
              </Workflow>
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:Merge" />
            </Expression>
            <Expression xsi:type="ExternalizedMapping">
              <Property Name="DueTime" DisplayName="Delay" Category="SphereTimings" />
            </Expression>
            <Expression xsi:type="Combinator">
              <Combinator xsi:type="rx:DelaySubscription">
                <rx:DueTime>PT5S</rx:DueTime>
              </Combinator>
            </Expression>
          </Nodes>
          <Edges>
            <Edge From="0" To="1" Label="Source1" />
            <Edge From="1" To="2" Label="Source1" />
            <Edge From="2" To="11" Label="Source2" />
            <Edge From="3" To="4" Label="Source1" />
            <Edge From="4" To="5" Label="Source1" />
            <Edge From="5" To="11" Label="Source1" />
            <Edge From="6" To="7" Label="Source1" />
            <Edge From="7" To="11" Label="Source3" />
            <Edge From="8" To="9" Label="Source1" />
            <Edge From="9" To="11" Label="Source4" />
            <Edge From="10" To="11" Label="Source5" />
            <Edge From="11" To="12" Label="Source1" />
            <Edge From="12" To="13" Label="Source1" />
            <Edge From="12" To="15" Label="Source1" />
            <Edge From="12" To="17" Label="Source1" />
            <Edge From="12" To="19" Label="Source1" />
            <Edge From="13" To="14" Label="Source1" />
            <Edge From="15" To="16" Label="Source1" />
            <Edge From="17" To="18" Label="Source1" />
            <Edge From="19" To="20" Label="Source1" />
            <Edge From="21" To="25" Label="Source1" />
            <Edge From="22" To="25" Label="Source2" />
            <Edge From="23" To="25" Label="Source3" />
            <Edge From="24" To="25" Label="Source4" />
            <Edge From="25" To="27" Label="Source1" />
            <Edge From="26" To="27" Label="Source2" />
            <Edge From="27" To="28" Label="Source1" />
            <Edge From="28" To="29" Label="Source1" />
            <Edge From="29" To="30" Label="Source1" />
            <Edge From="30" To="31" Label="Source1" />
            <Edge From="31" To="33" Label="Source1" />
            <Edge From="32" To="33" Label="Source2" />
          </Edges>
        </Workflow>
      </Expression>
      <Expression xsi:type="Disable">
        <Builder xsi:type="GroupWorkflow">
          <Name>DataLogger</Name>
          <Workflow>
            <Nodes>
              <Expression xsi:type="BehaviorSubject" TypeArguments="sys:Tuple(rx:ElementIndex(sys:Tuple(sys:Tuple(sys:Double,sys:Double,sys:Double),sys:Tuple(sys:Double,sys:Double,sys:Double),sys:Tuple(sys:Double,sys:Double))),sys:Tuple(sys:Single,sys:Int64))">
                <Name>Params</Name>
              </Expression>
              <Expression xsi:type="Combinator">
                <Combinator xsi:type="gl:UpdateFrame" />
              </Expression>
              <Expression xsi:type="MemberSelector">
                <Selector>TimeStep</Selector>
              </Expression>
              <Expression xsi:type="rx:Accumulate" />
              <Expression xsi:type="Combinator">
                <Combinator xsi:type="rx:ElementIndex" />
              </Expression>
              <Expression xsi:type="Combinator">
                <Combinator xsi:type="rx:CombineLatest" />
              </Expression>
              <Expression xsi:type="scr:ExpressionTransform">
                <scr:Expression>new(
Item2.Index as Frame,
Item2.Value.ElapsedTime as FrameTime,
Item2.Value.ElapsedRealTime as RealFrameTime,
Item1.Item1.Index as Id,
Item1.Item1.Value.Item1.Item1 as Azimuth,
Item1.Item1.Value.Item1.Item2 as Elevation,
Item1.Item1.Value.Item1.Item3 as Radius,
Item1.Item1.Value.Item2.Item1 as X,
Item1.Item1.Value.Item2.Item2 as Y,
Item1.Item1.Value.Item2.Item3 as Z,
Item1.Item1.Value.Item3.Item1 as Z0,
Item1.Item1.Value.Item3.Item2 as Size,
Item1.Item2.Item1 as Ambient,
Item1.Item2.Item2 as AmbientTimer
)</scr:Expression>
              </Expression>
              <Expression xsi:type="io:CsvWriter">
                <io:FileName>saved_csv\AllParams.csv</io:FileName>
                <io:Append>false</io:Append>
                <io:Overwrite>false</io:Overwrite>
                <io:Suffix>Timestamp</io:Suffix>
                <io:IncludeHeader>true</io:IncludeHeader>
              </Expression>
              <Expression xsi:type="WorkflowOutput" />
            </Nodes>
            <Edges>
              <Edge From="0" To="5" Label="Source1" />
              <Edge From="1" To="2" Label="Source1" />
              <Edge From="2" To="3" Label="Source1" />
              <Edge From="3" To="4" Label="Source1" />
              <Edge From="4" To="5" Label="Source2" />
              <Edge From="5" To="6" Label="Source1" />
              <Edge From="6" To="7" Label="Source1" />
              <Edge From="7" To="8" Label="Source1" />
            </Edges>
          </Workflow>
        </Builder>
      </Expression>
    </Nodes>
    <Edges />
  </Workflow>
</WorkflowBuilder>